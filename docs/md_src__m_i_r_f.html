<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NRF24L+ STM8 Compatible Library: NRF24 Library Usage Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NRF24L+ STM8 Compatible Library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">NRF24 Library Usage Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Check <a class="el" href="mirf_8c.html" title="This file contains the NRF24 library ported to the STM8 using SDCC.">mirf.c</a> for more details.</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Prerequisites</h1>
<p>Before using this library, ensure that you have the following:</p>
<ul>
<li>STM8 microcontroller development board.</li>
<li>PlatformIO with STLink driver support</li>
<li>NRF24 module connected to the STM8 board with appropriate wiring.</li>
</ul>
<h1><a class="anchor" id="autotoc_md7"></a>
Configuration</h1>
<h2><a class="anchor" id="autotoc_md8"></a>
Pins Configuration</h2>
<p>Make sure to define the pins connected to the NRF24 module in the library using the following macros:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define CE_PIN_LETTER GPIOC</span></div>
<div class="line"><span class="preprocessor">#define CE_PIN_NUMBER GPIO_PIN_4</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define CSN_PIN_LETTER GPIOC</span></div>
<div class="line"><span class="preprocessor">#define CSN_PIN_NUMBER GPIO_PIN_3</span></div>
</div><!-- fragment --><p>Adjust these macros based on your actual hardware configuration.</p>
<h2><a class="anchor" id="autotoc_md9"></a>
NRF Configuration</h2>
<p>Set the NRF channel number and payload size using the following macros:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define NRF_CHANNEL_NR 114</span></div>
<div class="line"><span class="preprocessor">#define NRF_PAYLOAD_SIZE 32</span></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md10"></a>
Initialization</h1>
<p>To initialize the NRF24 module, use the <code><a class="el" href="mirf_8c.html#a9ed171af704468994136122b94aeb3ba" title="This function initializes the CE/CS Pins and SPI.">Nrf24_init()</a></code> function. This function configures the CE/CS pins and SPI.</p>
<div class="fragment"><div class="line"><a class="code" href="mirf_8c.html#a9ed171af704468994136122b94aeb3ba">Nrf24_init</a>();</div>
<div class="ttc" id="amirf_8c_html_a9ed171af704468994136122b94aeb3ba"><div class="ttname"><a href="mirf_8c.html#a9ed171af704468994136122b94aeb3ba">Nrf24_init</a></div><div class="ttdeci">void Nrf24_init()</div><div class="ttdoc">This function initializes the CE/CS Pins and SPI.</div><div class="ttdef"><b>Definition:</b> mirf.c:52</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md11"></a>
Sending Data</h1>
<p>To send data, use the <code>Nrf24_send</code> function. Provide the data array and a pointer to a boolean indicating the RX/TX state of the NRF module.</p>
<div class="fragment"><div class="line">uint8_t data[<a class="code" href="mirf_8c.html#a4ebe92e97e1063efdcbcda6af2fa3aa6">NRF_PAYLOAD_SIZE</a>] = { <span class="comment">/* your data here */</span> };</div>
<div class="line"><span class="keywordtype">bool</span> PTX = <span class="comment">/* true if in TX mode, false if in RX mode */</span>;</div>
<div class="line"><a class="code" href="mirf_8c.html#aa30f7d76954ad77dafd2825c4cd60c3f">Nrf24_send</a>(data, &amp;PTX);- STM8 libraries installed.</div>
<div class="ttc" id="amirf_8c_html_a4ebe92e97e1063efdcbcda6af2fa3aa6"><div class="ttname"><a href="mirf_8c.html#a4ebe92e97e1063efdcbcda6af2fa3aa6">NRF_PAYLOAD_SIZE</a></div><div class="ttdeci">#define NRF_PAYLOAD_SIZE</div><div class="ttdoc">Payload size for the NRF, must be the same in all devices.</div><div class="ttdef"><b>Definition:</b> mirf.c:39</div></div>
<div class="ttc" id="amirf_8c_html_aa30f7d76954ad77dafd2825c4cd60c3f"><div class="ttname"><a href="mirf_8c.html#aa30f7d76954ad77dafd2825c4cd60c3f">Nrf24_send</a></div><div class="ttdeci">void Nrf24_send(uint8_t *value, bool *PTX)</div><div class="ttdoc">Sends a data package to the default address. Be sure to send the correct amount of bytes as configure...</div><div class="ttdef"><b>Definition:</b> mirf.c:355</div></div>
</div><!-- fragment --><ul>
<li><code>Nrf24_setTADDR</code>: Set the transmitting device address.</li>
<li><code>Nrf24_addRADDR</code>: Add more device addresses to receive.</li>
<li><code>Nrf24_SetOutputRF_PWR</code>: Set the transmission power.</li>
<li><code>Nrf24_SetSpeedDataRates</code>: Select between high-speed data rates.</li>
<li><code>Nrf24_setRetransmitDelay</code>: Set the auto retransmit delay.</li>
</ul>
<p>Refer to the function descriptions in the code for more details on each configuration function.</p>
<h1><a class="anchor" id="autotoc_md12"></a>
Power Management</h1>
<p>Control the power state of the NRF24 module using the following functions:</p>
<ul>
<li><code>Nrf24_powerUpRx</code>: Power up the NRF module for receiving.</li>
<li><code>Nrf24_powerUpTx</code>: Power up the NRF module for transmitting.</li>
<li><code>Nrf24_powerDown</code>: Power down the NRF module.</li>
</ul>
<h1><a class="anchor" id="autotoc_md13"></a>
Status and Checking</h1>
<p>Use the following functions to check the status and monitor the communication:</p>
<ul>
<li><code>Nrf24_getStatus</code>: Get the status register value.</li>
<li><code>Nrf24_isSending</code>: Check if the module is still sending.</li>
<li><code>Nrf24_isSend</code>: Check if sending has finished or retries are over.</li>
</ul>
<h1><a class="anchor" id="autotoc_md14"></a>
Usage Example</h1>
<p>The main.cpp file comes with an example on how to set up the NRF.</p>
<h2><a class="anchor" id="autotoc_md15"></a>
1. GPIO Configuration</h2>
<p>First, configure the necessary GPIO pins for debugging LEDs and the button. Additionally, set up an interrupt for the button.</p>
<div class="fragment"><div class="line"><span class="comment">// Debuging LEDs</span></div>
<div class="line">GPIO_Init(GPIOB, GPIO_PIN_1, GPIO_MODE_OUT_OD_LOW_FAST);</div>
<div class="line">GPIO_Init(GPIOB, GPIO_PIN_2, GPIO_MODE_OUT_OD_LOW_FAST);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Button</span></div>
<div class="line">GPIO_Init(GPIOB, GPIO_PIN_0, GPIO_MODE_IN_PU_IT);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Interrupt for button</span></div>
<div class="line">EXTI_DeInit();</div>
<div class="line">EXTI_SetExtIntSensitivity(EXTI_PORT_GPIOB, EXTI_SENSITIVITY_FALL_ONLY);</div>
<div class="line">EXTI_SetTLISensitivity(EXTI_TLISENSITIVITY_FALL_ONLY);</div>
<div class="line"> </div>
<div class="line">enableInterrupts();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Turn off LEDs</span></div>
<div class="line">GPIO_WriteHigh(GPIOB, GPIO_PIN_1);</div>
<div class="line">GPIO_WriteHigh(GPIOB, GPIO_PIN_2);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md16"></a>
2. NRF24 Initialization</h2>
<p>Initialize the NRF24 module and configure it based on your application requirements.</p>
<div class="fragment"><div class="line"><a class="code" href="mirf_8c.html#a9ed171af704468994136122b94aeb3ba">Nrf24_init</a>();</div>
<div class="line"><span class="keywordtype">bool</span> PTX = 0;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="mirf_8c.html#a4f5466685b94668e838714f0938b52ee">Nrf24_config</a>(&amp;PTX);</div>
<div class="ttc" id="amirf_8c_html_a4f5466685b94668e838714f0938b52ee"><div class="ttname"><a href="mirf_8c.html#a4f5466685b94668e838714f0938b52ee">Nrf24_config</a></div><div class="ttdeci">void Nrf24_config(bool *PTX)</div><div class="ttdoc">This sends the necessary registers to the NRF. Initially on RX mode.</div><div class="ttdef"><b>Definition:</b> mirf.c:169</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md17"></a>
3. Set Own and Receiver Addresses</h2>
<p>Set the own address and the receiver address using 5 characters. Ensure the addresses are unique and match between the transmitter and receiver.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> ret;</div>
<div class="line"> </div>
<div class="line">ret = <a class="code" href="mirf_8c.html#acc49f1dc3c4b4482277b33b120c97b26">Nrf24_setRADDR</a>((uint8_t *)<span class="stringliteral">&quot;ABCDE&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span> (ret != SUCCESS)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">while</span> (1)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="delay_8c.html#ab7cce8122024d7ba47bf10f434956de4">delay_ms</a>(1);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">ret = <a class="code" href="mirf_8c.html#a8f3e77a2dcf7c8a359b9be8c667acfde">Nrf24_setTADDR</a>((uint8_t *)<span class="stringliteral">&quot;FGHIJ&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span> (ret != SUCCESS)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">while</span> (1)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="delay_8c.html#ab7cce8122024d7ba47bf10f434956de4">delay_ms</a>(1);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="adelay_8c_html_ab7cce8122024d7ba47bf10f434956de4"><div class="ttname"><a href="delay_8c.html#ab7cce8122024d7ba47bf10f434956de4">delay_ms</a></div><div class="ttdeci">void delay_ms(uint32_t ms)</div><div class="ttdoc">Generates a delay in ms.</div><div class="ttdef"><b>Definition:</b> delay.c:14</div></div>
<div class="ttc" id="amirf_8c_html_a8f3e77a2dcf7c8a359b9be8c667acfde"><div class="ttname"><a href="mirf_8c.html#a8f3e77a2dcf7c8a359b9be8c667acfde">Nrf24_setTADDR</a></div><div class="ttdeci">ErrorStatus Nrf24_setTADDR(uint8_t *adr)</div><div class="ttdoc">Sets the transmitting device address.</div><div class="ttdef"><b>Definition:</b> mirf.c:208</div></div>
<div class="ttc" id="amirf_8c_html_acc49f1dc3c4b4482277b33b120c97b26"><div class="ttname"><a href="mirf_8c.html#acc49f1dc3c4b4482277b33b120c97b26">Nrf24_setRADDR</a></div><div class="ttdeci">ErrorStatus Nrf24_setRADDR(uint8_t *adr)</div><div class="ttdoc">Sets the recieving address (5) bytes!</div><div class="ttdef"><b>Definition:</b> mirf.c:184</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md18"></a>
4. Configure Communication Parameters</h2>
<p>Set the communication parameters such as data rate and retransmit delay.</p>
<div class="fragment"><div class="line"><a class="code" href="mirf_8c.html#ad79ccd9a834c841c6e3794e4624a186a">Nrf24_SetSpeedDataRates</a>(<a class="code" href="mirf_8h.html#a82745de4aa1251b7561564b3ed1d6522afd01f3fd55247a67c0bcfd459fe17fdf">RF24_1MBPS</a>);</div>
<div class="line"><a class="code" href="mirf_8c.html#a9e1672761009b07f02ff26ad1214bb37">Nrf24_setRetransmitDelay</a>(0);</div>
<div class="ttc" id="amirf_8c_html_a9e1672761009b07f02ff26ad1214bb37"><div class="ttname"><a href="mirf_8c.html#a9e1672761009b07f02ff26ad1214bb37">Nrf24_setRetransmitDelay</a></div><div class="ttdeci">void Nrf24_setRetransmitDelay(uint8_t val)</div><div class="ttdoc">Set Auto Retransmit Delay.</div><div class="ttdef"><b>Definition:</b> mirf.c:541</div></div>
<div class="ttc" id="amirf_8c_html_ad79ccd9a834c841c6e3794e4624a186a"><div class="ttname"><a href="mirf_8c.html#ad79ccd9a834c841c6e3794e4624a186a">Nrf24_SetSpeedDataRates</a></div><div class="ttdeci">void Nrf24_SetSpeedDataRates(uint8_t val)</div><div class="ttdoc">Select between the high speed data rates.</div><div class="ttdef"><b>Definition:</b> mirf.c:516</div></div>
<div class="ttc" id="amirf_8h_html_a82745de4aa1251b7561564b3ed1d6522afd01f3fd55247a67c0bcfd459fe17fdf"><div class="ttname"><a href="mirf_8h.html#a82745de4aa1251b7561564b3ed1d6522afd01f3fd55247a67c0bcfd459fe17fdf">RF24_1MBPS</a></div><div class="ttdeci">@ RF24_1MBPS</div><div class="ttdef"><b>Definition:</b> mirf.h:176</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md19"></a>
5. Main Loop</h2>
<p>Implement the main loop to handle communication and LED control based on button presses.</p>
<div class="fragment"><div class="line">uint8_t buf[32];</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Clear RX FiFo</span></div>
<div class="line"><span class="keywordflow">while</span> (1)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="mirf_8c.html#a65d80ff553d151811dde0636cdd17f0f">Nrf24_dataReady</a>() == FALSE)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="mirf_8c.html#a10082b1d20ffb577020449c65e523796">Nrf24_getData</a>(buf);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">while</span> (1)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// When the program is received, the received data is output from the serial port</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="mirf_8c.html#a65d80ff553d151811dde0636cdd17f0f">Nrf24_dataReady</a>())</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Turns the led on when a packet is received if the button was clicked</span></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="main_8c.html#a35d22412c34eb149d8973b4120261873">bIntFlag</a> == 1)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="main_8c.html#a35d22412c34eb149d8973b4120261873">bIntFlag</a> = 0;</div>
<div class="line">            GPIO_WriteLow(GPIOB, GPIO_PIN_1);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            GPIO_WriteHigh(GPIOB, GPIO_PIN_1);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="mirf_8c.html#a10082b1d20ffb577020449c65e523796">Nrf24_getData</a>(buf);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// The ESP is printing stuff so it takes a while to switch to RX mode.</span></div>
<div class="line">        <a class="code" href="delay_8c.html#ab7cce8122024d7ba47bf10f434956de4">delay_ms</a>(10);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="mirf_8c.html#aa30f7d76954ad77dafd2825c4cd60c3f">Nrf24_send</a>(buf, &amp;PTX);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Same here, delay a bit.</span></div>
<div class="line">        <a class="code" href="delay_8c.html#ab7cce8122024d7ba47bf10f434956de4">delay_ms</a>(10);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">while</span> (!<a class="code" href="mirf_8c.html#a958dfb81dd996b6d339b0f3441fd8531">Nrf24_isSend</a>(50, &amp;PTX))</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// If no ACK after the preconfigured retries, send again.</span></div>
<div class="line">            <a class="code" href="mirf_8c.html#aa30f7d76954ad77dafd2825c4cd60c3f">Nrf24_send</a>(buf, &amp;PTX);</div>
<div class="line">            <a class="code" href="delay_8c.html#ab7cce8122024d7ba47bf10f434956de4">delay_ms</a>(10);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// Wait a bit to check if the NRF received data.</span></div>
<div class="line">    <a class="code" href="delay_8c.html#ab7cce8122024d7ba47bf10f434956de4">delay_ms</a>(1);</div>
<div class="line">}</div>
<div class="ttc" id="amain_8c_html_a35d22412c34eb149d8973b4120261873"><div class="ttname"><a href="main_8c.html#a35d22412c34eb149d8973b4120261873">bIntFlag</a></div><div class="ttdeci">unsigned int bIntFlag</div><div class="ttdef"><b>Definition:</b> main.c:48</div></div>
<div class="ttc" id="amirf_8c_html_a10082b1d20ffb577020449c65e523796"><div class="ttname"><a href="mirf_8c.html#a10082b1d20ffb577020449c65e523796">Nrf24_getData</a></div><div class="ttdeci">void Nrf24_getData(uint8_t *data)</div><div class="ttdoc">Reads NRF payload bytes into data array.</div><div class="ttdef"><b>Definition:</b> mirf.c:296</div></div>
<div class="ttc" id="amirf_8c_html_a65d80ff553d151811dde0636cdd17f0f"><div class="ttname"><a href="mirf_8c.html#a65d80ff553d151811dde0636cdd17f0f">Nrf24_dataReady</a></div><div class="ttdeci">bool Nrf24_dataReady()</div><div class="ttdoc">Checks if data is available for reading.</div><div class="ttdef"><b>Definition:</b> mirf.c:265</div></div>
<div class="ttc" id="amirf_8c_html_a958dfb81dd996b6d339b0f3441fd8531"><div class="ttname"><a href="mirf_8c.html#a958dfb81dd996b6d339b0f3441fd8531">Nrf24_isSend</a></div><div class="ttdeci">bool Nrf24_isSend(int timeout, bool *PTX)</div><div class="ttdoc">Test if Sending has finished or retry is over.</div><div class="ttdef"><b>Definition:</b> mirf.c:406</div></div>
</div><!-- fragment --><p>Adjust the code as needed for your specific application logic and use case. Ensure that the button press detection and LED control match your hardware setup. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
